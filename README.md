Este código fue para automatizar la descarga masiva de archivos que contienen datos de las estaciones climatológicas encontradas en Zacatecas y sus alrededores. 
Se descargaron más de 600 archivos haciendo una selección previa de los mismos que se enumeran en el archivo llamado numbers_unique_selected. 
El archivo Output_point_layer1 es el archivo que nos apoya a darnos los links utilizados para descargar los archivos. 
Previamente se realizó un filtro, ya que estaban los datos de todas las estaciones climatológicas del país, pero se escogieron sólamente las estaciones de interés.
Se adjunta también un ejemplo de archivo diario y mensual en formato txt y el formato final xlsm.\

Lo primero que se realizó es la organización de estos archivos en carpetas según su tipo de información, ya sea diarios, extremos o mensuales. Las carpetas se crean si es que no existen, luego se lee el csv recorriendo cada fila, realizando una petición al servidor y verificando si de verdad se guarda el archivo. Se utilizan bloques try-except por el dado caso de que la descarga falle, para sí no interrumpir el sistema.\

En el código DIARIO se automatizó la conversión de los archivos ya descargados en archivos habilitados para macros, es el segundo código que se utilizó, el primero tiene defectos. Lo primero es detectar los archivos txt y luego crear una carpeta para los archivos de salida llamada DIARIOS_excel. Se abre y se lee con la codificación adecuada, además de detectar en dónde están empezando realmente las tablas, eliminando las filas que pueden hacer ruido al momento de realizar análisis estadísticos. Se convierte primero de txt a xlsx y de ahí a xlsm.\

El código para la información climatológica mensual estuvo más complicado, ya que se encontraban varias tablas en el mismo archivo, y teniendo varios datos vacios difíciles de acomodar en automático, además de que el nombre de las tablas tenían acento, cosa difícil de detectarla en código. Primero se definen las carpetas de entrada y salida, luego usar un diccionario para corregir los nombres de las tablas que vienen mal codificadas (por ejemplo, problemas con acentos como “MÃ\x81XIMA”, que en realidad era "MÁXIMA"). Para poder leer cada archivo de texto de manera correcta, se abre con codificación latin-1, recorriendo linea por línea y detectando cuándo es que empiezan las tablas según los títulos. Limpiamos filas vacías, corrige nombres de colunas y los valores, organizamos los datos eliminando encabezados duplicados, entre otras cosas. Finalmente, se crea el archivo xlsx teniendo cada tabla en una hoja distinta, una por tipo de variable. Se guarda en formato xlsm, teniendo un convertidor de archivos de texto con múltiples tablas mensuales en archivos Excel estructurados, limpios y listos para análisis.\

Data source: Servicio Meteorológico Nacional (SMN), CONAGUA, Mexico.
https://smn.conagua.gob.mx
